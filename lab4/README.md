# Отчет по лабораторной работе №4
## Тема: Решение задачи динамического программирования

**Студент:** Шаповалов Сергей Кириллович  
**Группа:** К3341  
**Поток:** МЕТОПТ 1.1  
**Преподаватель:** Юрий Бондарев  

---

## Цель работы

Требуется разработать такой план управления закупками/продажами ценных бумаг и депозитов, чтобы суммарный объем дохода был максимальным. Поскольку в задаче присутствуют вероятности, для оценки дохода необходимо использовать критерии принятия решений в условиях неопределенности. При программной реализации можно выбрать один из них, например, критерий Байеса.

---

## Решение без использования ЯП

### Исходные данные (в формализованном виде)

#### Активы на начало

| Актив          | Стоимость |
|----------------|-----------|
| ЦБ1            | 100       |
| ЦБ2            | 800       |
| Депозиты       | 400       |
| Свободные средства | 600   |

#### Вероятности сценариев

| Этап | Благопр. | Нейтр. | Негатив |
|------|----------|--------|---------|
| 1    | 0,6      | 0,3    | 0,1     |
| 2    | 0,3      | 0,2    | 0,5     |
| 3    | 0,4      | 0,4    | 0,2     |

#### Коэффициенты изменения стоимости активов

**ЦБ1:**

| Этап | Благопр. | Нейтр. | Негатив |
|------|----------|--------|---------|
| 1    | 1,20     | 1,05   | 0,80    |
| 2    | 1,40     | 1,05   | 0,60    |
| 3    | 1,15     | 1,05   | 0,70    |

**ЦБ2:**

| Этап | Благопр. | Нейтр. | Негатив |
|------|----------|--------|---------|
| 1    | 1,10     | 1,02   | 0,95    |
| 2    | 1,15     | 1,00   | 0,90    |
| 3    | 1,12     | 1,01   | 0,94    |

**Депозиты:**

| Этап | Благопр. | Нейтр. | Негатив |
|------|----------|--------|---------|
| 1    | 1,07     | 1,03   | 1,00    |
| 2    | 1,01     | 1,00   | 1,00    |
| 3    | 1,05     | 1,01   | 1,00    |

#### Комиссии брокеров

| Актив   | Комиссия |
|---------|----------|
| ЦБ1     | 4%       |
| ЦБ2     | 7%       |
| Депозиты| 5%       |

Комиссия удерживается при покупке и продаже.

#### Шаговое управление

Разрешено покупать/продавать долю, кратную 25% от начального объема:

| Актив   | Шаг |
|---------|-----|
| ЦБ1     | 25  |
| ЦБ2     | 200 |
| Депозиты| 100 |

#### Ограничения на портфель

| Актив   | Минимум |
|---------|---------|
| ЦБ1     | >= 30   |
| ЦБ2     | >= 150  |
| Депозиты| >= 100  |

---

## Критерий оптимальности

Используем критерий Байеса — максимизация математического ожидания итогового капитала:

$$
\max E[W_3], \quad W_3 = ЦБ1_3 + ЦБ2_3 + Деп_3 + Сб.деньги_3
$$

---

## Ожидаемая доходность активов

### Этап 1 - ожидаемые коэффициенты

- ЦБ1: $E_1(\text{ЦБ1}) = 0.6 \cdot 1.2 + 0.3 \cdot 1.05 + 0.1 \cdot 0.8 = 1.115$  
- ЦБ2: $E_1(\text{ЦБ2}) = 1.061$  
- Депозиты: $E_1(\text{Деп}) = 1.052$


**Лидер:** ЦБ1, несмотря на комиссию.

### Этап 2 - ожидаемые коэффициенты

| Актив | E      |
|-------|--------|
| ЦБ1   | 0.93   |
| ЦБ2   | 0.995  |
| Деп   | 1.003  |

**Оптимально:** уход в депозиты.

### Этап 3 - ожидаемые коэффициенты

| Актив | E      |
|-------|--------|
| ЦБ1   | 1.02   |
| ЦБ2   | 1.04   |
| Деп   | 1.024  |

**Лидер:** ЦБ2

---

## Оптимальная стратегия управления

### Перед этапом 1

- Продать часть ЦБ2 (учет комиссии 7%)  
- Купить ЦБ1 (шагами по 25)  
- Минимально допустимые депозиты сохранить  

**Цель:** агрессивный рост

### Перед этапом 2

- Продать максимально возможный объем ЦБ1  
- Перевести средства в депозиты  
- Соблюсти минимум по активам  

**Цель:** защита капитала

### Перед этапом 3

- Продать часть депозитов  
- Купить ЦБ2 (шагами по 200)  
- Часть средств оставить на депозите  

**Цель:** умеренный рост при низком риске

---

## Решение с использованием Python

```python
import itertools

initial_portfolio = {
    "CB1": 100,
    "CB2": 800,
    "Dep": 400,
    "Cash": 600
}

min_assets = {
    "CB1": 30,
    "CB2": 150,
    "Dep": 100
}

commission = {
    "CB1": 0.04,
    "CB2": 0.07,
    "Dep": 0.05
}

steps = {
    "CB1": 25,
    "CB2": 200,
    "Dep": 100
}

scenarios = [
    {
        "probs": [0.6, 0.3, 0.1],
        "CB1": [1.2, 1.05, 0.8],
        "CB2": [1.1, 1.02, 0.95],
        "Dep": [1.07, 1.03, 1.0]
    },
    {
        "probs": [0.3, 0.2, 0.5],
        "CB1": [1.4, 1.05, 0.6],
        "CB2": [1.15, 1.0, 0.9],
        "Dep": [1.01, 1.0, 1.0]
    },
    {
        "probs": [0.4, 0.4, 0.2],
        "CB1": [1.15, 1.05, 0.7],
        "CB2": [1.12, 1.01, 0.94],
        "Dep": [1.05, 1.01, 1.0]
    }
]

def apply_scenario(portfolio, scenario):
    new_portfolio = {}
    for asset in ["CB1", "CB2", "Dep"]:
        new_portfolio[asset] = sum(
            p * portfolio[asset] * r
            for p, r in zip(scenario["probs"], scenario[asset])
        )
    new_portfolio["Cash"] = portfolio["Cash"]
    return new_portfolio

def adjust_portfolio(portfolio, adjustments):
    new_portfolio = portfolio.copy()
    cash = portfolio["Cash"]
    for asset, delta in adjustments.items():
        if delta > 0:
            cost = delta * (1 + commission[asset])
            if cost > cash:
                delta = cash / (1 + commission[asset])
                cost = delta * (1 + commission[asset])
            cash -= cost
            new_portfolio[asset] += delta
        elif delta < 0:
            delta = -delta
            if new_portfolio[asset] - delta < min_assets[asset]:
                delta = new_portfolio[asset] - min_assets[asset]
            cash += delta * (1 - commission[asset])
            new_portfolio[asset] -= delta
    new_portfolio["Cash"] = cash
    return new_portfolio

plan_steps = [
    {"CB1": 25, "CB2": -200, "Dep": 0},
    {"CB1": -100, "CB2": 0, "Dep": 0},
    {"CB1": 0, "CB2": 200, "Dep": -100}
]

portfolio = initial_portfolio.copy()
print("\n--- Начальный портфель ---")
for k, v in portfolio.items():
    print(f"{k}: {v:.2f}")
    

for t in range(3):
    portfolio = adjust_portfolio(portfolio, plan_steps[t])
    portfolio = apply_scenario(portfolio, scenarios[t])
    
    print(f"Этап {t+1}:")
    print("Портфель после применения плана и сценария:")
    for k, v in portfolio.items():
        print(f"  {k}: {v:.2f}")
    total = sum(portfolio.values())
    print(f"  Общая стоимость портфеля: {total:.2f}\n")

print("=== Итоговый портфель ===")
for k, v in portfolio.items():
    print(f"{k}: {v:.2f}")
total = sum(portfolio.values())
print(f"\nМаксимальный ожидаемый доход: {total:.2f}")
```

Получаем такой вывод программы:

![png](/lab4/image.png)

### Вывод

В ходе работы была решена задача пошагового управления инвестиционным портфелем с использованием критерия Байеса. Были изучены методы оценки ожидаемой доходности активов при неопределенности, учтены комиссии и ограничения на минимальные объемы вложений.

На практике удалось освоить:

1. Формализацию инвестиционной задачи
2. Расчет оптимальных действий на каждом этапе
3. Использование пошагового управления для максимизации ожидаемого капитала

Работа развила навыки анализа вероятностных сценариев и принятия решений в условиях риска.